<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Despachos ruta 700 </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0d6efd" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <style>
    :root{
      --bg: linear-gradient(135deg,#eef2ff 0%,#f7f9ff 50%,#eef6ff 100%);
      --brand:#0d6efd; --ink:#0b1022; --muted:#6b7280; --card:#ffffff;
      --ring:#dbe4ff; --shadow: 0 12px 36px rgba(16,24,40,.12);
      --scale: 1; /* zoom del contenido */
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent }
    html,body{ height:100%; margin:0; padding:0; }
    body{
      font-family: ui-sans-serif, system-ui, "Segoe UI", Roboto, Arial, "Helvetica Neue", sans-serif;
      color: var(--ink);
      background: var(--bg);
    }

    .app{
      min-height: 100dvh;
      display:flex; flex-direction:column;
      padding: calc(8px + var(--safe-top)) 12px calc(8px + var(--safe-bottom));
      gap:12px;
    }

    .shell{
      max-width: 1200px; width:100%; margin:0 auto;
      background: var(--card);
      border:1px solid var(--ring);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow: clip;
      display:flex; flex-direction:column;
      min-height: 70dvh;
    }

    .header{
      display:flex; align-items:center; gap:10px;
      padding:12px 14px;
      border-bottom: 1px solid #eef2ff;
      background: #fff;
    }
    .logo{
      width:36px; height:36px; border-radius:10px;
      background: radial-gradient(100% 100% at 0% 0%, #90c0ff 0%, #5e8cff 40%, #3b6eff 100%);
      display:grid; place-items:center; color:#fff; font-weight:900;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.6);
    }
    .title{ font-weight:800; font-size:18px; letter-spacing:.2px }
    .actions{ margin-left:auto; display:flex; gap:8px; flex-wrap:wrap }
    .btn{
      border:1px solid #dde3ff; background:#f5f7ff; color:#1d2b6b;
      padding:8px 12px; border-radius:10px; font-weight:800; cursor:pointer;
    }
    .btn.primary{ background:var(--brand); color:#fff; border-color:transparent }
    .btn:active{ transform: translateY(1px) }
    .sep{ width:1px; height:28px; background:#e9ecff; }

    /* Marco del iframe + zoom */
    .frame-viewport{
      position:relative; flex:1 1 auto; background:#f8faff;
      /* altura exacta: el JS ajusta si hiciera falta */
      min-height: 60dvh;
    }
    .frame-scale{
      position:absolute; inset:0;
      transform: scale(var(--scale));
      transform-origin: top center;
      width: calc(100% / var(--scale));
      height: calc(100% / var(--scale));
      display:flex;
    }
    iframe{
      border:0; width:100%; height:100%;
      background:#fff;
    }

    .footer{
      padding:10px 14px; font-size:12px; color:var(--muted);
      border-top:1px solid #eef2ff; background:#fff;
      display:flex; justify-content:space-between; gap:8px; flex-wrap:wrap;
    }

    /* Topbar fuera de la tarjeta (opcional) */
    .topbar{
      max-width:1200px; width:100%; margin:0 auto;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      color:#1d2b6b;
    }
    .topbar h1{ margin:0; font-size:22px; font-weight:900; letter-spacing:.3px }
    .zoom-ind{ font-weight:800; background:#eef2ff; padding:4px 8px; border-radius:8px; }

    @media (max-width:740px){
      .header{ padding:10px 10px }
      .btn{ padding:8px 10px }
      .title{ font-size:16px }
      .topbar h1{ font-size:18px }
    }
  </style>
</head>
<body>

  <!-- Barra superior del shell -->
  <div class="topbar">
    <h1>Panel de Despachos</h1>
    <div class="zoom-ind">Zoom: <span id="zoomLabel">100%</span></div>
  </div>

  <div class="shell">
    <div class="header">
      <div class="logo">D</div>
      <div class="title">Despachos DESDI</div>
      <div class="actions">
        <button class="btn" id="zoomOut">−</button>
        <button class="btn" id="zoomReset">100%</button>
        <button class="btn" id="zoomIn">+</button>
        <div class="sep"></div>
        <button class="btn" id="reload">Recargar</button>
        <button class="btn" id="openNew">Abrir</button>
        <button class="btn primary" id="fullBtn">Pantalla completa</button>
      </div>
    </div>

    <div class="frame-viewport">
      <div class="frame-scale" id="scaleWrap">
        <!-- Pega la URL de tu webapp (…/exec) en APP_URL (en la Parte 2) -->
        <iframe id="appFrame" title="App de Despachos" allow="clipboard-read; clipboard-write" 
                sandbox="allow-scripts allow-forms allow-same-origin allow-popups allow-modals"></iframe>
      </div>
    </div>

    <div class="footer">
      <div>Aplicacion DESDI</div>
      <div id="hint"/>
    </div>
  </div>
  <script>
    // configuracion  
    const APP_URL = 'https://script.google.com/macros/s/AKfycbyujdvCP6Mr2OXdi6yCnzkCTv-Hqq1er9Pgg-KB2U5VaybbncUJ6GQh-_SLNUyUYrfGPw/exec'; // <-- reemplaza

    // ====== Estado del zoom (persistente) ======
    const ZOOM_KEY   = 'shell_zoom_v1';
    const ZOOM_MIN   = 0.80;
    const ZOOM_MAX   = 1.60;
    const ZOOM_STEP  = 0.10;

    const frame   = document.getElementById('appFrame');
    const scaleEl = document.getElementById('scaleWrap');
    const zoomLbl = document.getElementById('zoomLabel');

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
    function loadZoom(){ const v = parseFloat(localStorage.getItem(ZOOM_KEY)); return isNaN(v)?1:v; }
    function saveZoom(v){ localStorage.setItem(ZOOM_KEY, String(v)); }
    function setZoom(v){
      v = clamp(v, ZOOM_MIN, ZOOM_MAX);
      document.documentElement.style.setProperty('--scale', v);
      zoomLbl.textContent = Math.round(v*100)+'%';
      saveZoom(v);
    }

    // ====== UI botones ======
    document.getElementById('zoomIn').onclick    = () => setZoom(loadZoom()+ZOOM_STEP);
    document.getElementById('zoomOut').onclick   = () => setZoom(loadZoom()-ZOOM_STEP);
    document.getElementById('zoomReset').onclick = () => setZoom(1);

    document.getElementById('reload').onclick = () => {
      try { frame.contentWindow.location.reload(); }
      catch { frame.src = APP_URL + (APP_URL.includes('?') ? '&' : '?') + 't=' + Date.now(); }
    };
    document.getElementById('openNew').onclick = () => window.open(APP_URL, '_blank');

    // Fullscreen
    const shellEl = document.querySelector('.shell');
    const fullBtn = document.getElementById('fullBtn');
    function isFullscreen(){
      return document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement;
    }
    function enterFS(){
      (shellEl.requestFullscreen || shellEl.webkitRequestFullscreen || shellEl.msRequestFullscreen || shellEl.requestFullScreen).call(shellEl);
    }
    function exitFS(){
      (document.exitFullscreen || document.webkitExitFullscreen || document.msExitFullscreen || document.cancelFullScreen).call(document);
    }
    fullBtn.onclick = () => { isFullscreen() ? exitFS() : enterFS(); };

    document.addEventListener('fullscreenchange', () => {
      fullBtn.textContent = isFullscreen() ? 'Salir de pantalla completa' : 'Pantalla completa';
      fullBtn.classList.toggle('primary', !isFullscreen());
    });

    // ====== Carga inicial ======
    function init(){
      setZoom(loadZoom());
      frame.src = APP_URL + (APP_URL.includes('?') ? '&' : '?') + 'embedded=1';
      // Hint técnico (opcional)
      const hint = document.getElementById('hint');
      if (hint){
        hint.textContent = `Viewport ${window.innerWidth}×${window.innerHeight}px — DPR ${window.devicePixelRatio || 1}`;
      }
      // Ajuste iOS/Android 100vh: el contenedor ya usa flex; si se quiere, aquí podrías forzar altura.
    }
    document.addEventListener('DOMContentLoaded', init);

    // ====== Atajos de teclado ======
    document.addEventListener('keydown', (e)=>{
      // Ctrl/Cmd + +/-
      const mod = e.ctrlKey || e.metaKey;
      if (mod && (e.key === '+' || e.key === '=')){ e.preventDefault(); setZoom(loadZoom()+ZOOM_STEP); }
      if (mod && (e.key === '-' || e.key === '_')){ e.preventDefault(); setZoom(loadZoom()-ZOOM_STEP); }
      if (mod && (e.key === '0')){ e.preventDefault(); setZoom(1); }
      // f: fullscreen
      if (!mod && (e.key.toLowerCase() === 'f')){ e.preventDefault(); fullBtn.click(); }
      // r: recargar (cuando el foco no está dentro del iframe)
      if (!mod && e.key.toLowerCase() === 'r' && document.activeElement !== frame){ e.preventDefault(); document.getElementById('reload').click(); }
    });

    // ====== Recalcular indicadores cuando cambia la ventana (rotación móvil) ======
    window.addEventListener('resize', ()=>{
      const hint = document.getElementById('hint');
      if (hint) hint.textContent = `Viewport ${window.innerWidth}×${window.innerHeight}px — DPR ${window.devicePixelRatio || 1}`;
    });
  </script>

</body>
</html>




